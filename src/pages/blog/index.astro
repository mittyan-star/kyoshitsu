---
import BaseLayout from '../../layouts/BaseLayout.astro';
import { breadcrumbSchema } from '../../lib/schema';
import NoteFeed from '../../components/NoteFeed.astro';
import { fetchNoteFeed } from '../../lib/noteFeed';

const NOTE_FEED_URL = 'https://note.com/mittyan_star/rss';
const NOTE_FEED_LIMIT = 10;

let noteItems = [];
try {
  noteItems = await fetchNoteFeed(NOTE_FEED_URL, NOTE_FEED_LIMIT);
} catch (error) {
  console.error('noteフィードの取得に失敗しました', error);
}

const structuredData = [
  breadcrumbSchema([
    { name: 'ホーム', item: 'https://mittyan-star.github.io/kyoshitsu/' },
    { name: 'ブログ', item: 'https://mittyan-star.github.io/kyoshitsu/blog' },
  ]),
  {
    '@context': 'https://schema.org',
    '@type': 'Blog',
    name: 'みっちゃん塾note',
    description: 'noteで更新している最新の記事一覧。',
    url: 'https://mittyan-star.github.io/kyoshitsu/blog',
    blogPost: noteItems.map((entry) => ({
      '@type': 'BlogPosting',
      headline: entry.title,
      description: entry.contentSnippet,
      datePublished: entry.isoDate,
      url: entry.link ?? NOTE_FEED_URL,
    })),
  },
];
---
<BaseLayout
  title="ブログ｜教育×AI・学習法・事例紹介"
  description="みっちゃん塾のブログ一覧。教育×AI、学習法、探究事例、保護者へのヒントなどを定期的に更新します。"
  path="/blog"
  summary="毎週更新のブログで、生徒が説明する学びの実践例やAI活用のヒントをお届けします。"
  breadcrumbs={[{ href: '/blog', label: 'ブログ' }]}
  structuredData={structuredData}
>
  <section class="section">
    <h1 class="text-3xl font-bold text-slate-900">最新記事</h1>
    <NoteFeed
      items={noteItems}
      feedUrl={NOTE_FEED_URL}
      limit={NOTE_FEED_LIMIT}
      emptyMessage="noteでの記事公開をお待ちください。"
    />
  </section>
</BaseLayout>
